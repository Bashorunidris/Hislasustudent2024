<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HD - His Database</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #32CD32;
            --error: #FF6347;
            --bg-light: #F5F5F5;
            --text-dark: #333;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            background: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

       .logo {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 15px;
}

.logo-emblem {
    position: relative;
    width: 60px;
    height: 60px;
}

.logo-circle {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #2c3e50, #3498db);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    animation: pulse 2s infinite;
}

.logo-text {
    color: #fff;
    font-size: 24px;
    font-weight: 700;
    letter-spacing: 1px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.orbit {
    position: absolute;
    width: 150%;
    height: 150%;
    border: 2px dashed rgba(255,255,255,0.3);
    border-radius: 50%;
    animation: rotate 20s linear infinite;
}

.globe {
    position: absolute;
    top: -5px;
    left: 50%;
    width: 15px;
    height: 15px;
    background: #e74c3c;
    border-radius: 50%;
    box-shadow: 0 0 10px #e74c3c;
    animation: glow 2s ease-in-out infinite;
}

.logo-title {
    display: flex;
    flex-direction: column;
}

.logo-title h1 {
    font-size: 28px;
    font-weight: 700;
    color: #2c3e50;
    margin: 0;
    background: linear-gradient(45deg, #2c3e50, #3498db);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.logo-subtitle {
    font-size: 14px;
    color: #7f8c8d;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 4px;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes glow {
    0% { box-shadow: 0 0 10px #e74c3c; }
    50% { box-shadow: 0 0 20px #e74c3c; }
    100% { box-shadow: 0 0 10px #e74c3c; }
}

/* Responsive Design */
@media (max-width: 768px) {
    .logo-title h1 {
        font-size: 24px;
    }

    .logo-subtitle {
        font-size: 12px;
    }
}

         .master-auth-container {
    max-width: 500px;
    margin: 40px auto;
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    overflow: hidden;
}

.master-tabs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    background: #f8fafc;
    padding: 5px;
}

.master-tab {
    padding: 15px;
    border: none;
    background: none;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.master-tab.active {
    background: #2c3e50 ;
    color: white;
    border-radius: 10px;
}

.auth-section {
    display: none;
    padding: 30px;
}

.auth-section.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

.student-tabs {

    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 20px;
}

.tab-btn {
    padding: 12px;
    border: 2px solid #2c3e50 ;
    background: transparent;
    color: #2c3e50 ;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.tab-btn.active {
    background: #2c3e50 ;
    color: white;
}

.auth-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.auth-form input,
.auth-form select {
    padding: 14px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 16px;
}

.btn {
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-primary {
    background: #4299e1;
    color: white;
}

.btn-student {
    background: #48bb78;
    color: white;
}

.forgot-link {
    text-align: center;
    color: #4299e1;
    text-decoration: none;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

         /* Dashboard Layout */
.dashboard-toggle {
    background: var(--surface);
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    margin: 32px 0;
    overflow: hidden;
}

.dashboard-toggle summary {
    padding: 20px 32px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    font-size: 1.25rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.dashboard-toggle summary::before {
    content: 'â†’';
    margin-right: 12px;
    transition: transform 0.3s ease;
}

.dashboard-toggle[open] summary::before {
    transform: rotate(90deg);
}

/* Stats Section */
.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    padding: 32px;
    background: linear-gradient(to bottom, #f8fafc, #ffffff);
}

.stat-card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

.stat-card h3 {
    color: var(--text);
    font-size: 1.125rem;
    margin-bottom: 16px;
    font-weight: 600;
}

.stat-card p {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 16px;
    font-family: 'Inter', sans-serif;
}

.stat-trend {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
    color: #10B981;
    padding: 8px 12px;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 8px;
    width: fit-content;
}

/* Form Creation Section */
.form-container {
    padding: 32px;
    background: white;
    border-radius: 16px;
    margin: 24px 32px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
}

.form-container h2 {
    font-size: 1.5rem;
    color: var(--text);
    margin-bottom: 24px;
    font-weight: 600;
}

.input-group {
    margin-bottom: 24px;
}

.input-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text);
}

.input-group input,
.input-group select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #E2E8F0;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.input-group input:focus,
.input-group select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    outline: none;
}

 .input-group {
    margin-bottom: 25px;
    background: #ffffff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.input-group label {
    display: block;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 12px;
}

#formType {
    width: 100%;
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 16px;
    color: #4a5568;
    background: #fff;
    transition: all 0.3s ease;
    cursor: pointer;
}

#formType:focus {
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66,153,225,0.1);
}

.field-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    padding: 15px;
    background: #f7fafc;
    border-radius: 8px;
}

.field-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    background: white;
    border-radius: 6px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.field-item:hover {
    background: #edf2f7;
    transform: translateY(-2px);
}

.field-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    border: 2px solid #cbd5e0;
    border-radius: 4px;
    cursor: pointer;
}

.form-settings {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
    background: #f8fafc;
    border-radius: 12px;
    margin-top: 20px;
}

.setting-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: white;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.setting-item:hover {
    background: #edf2f7;
}

.deadline-picker {
    padding: 8px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    margin-left: 10px;
}

#responseLimit {
    width: 100px;
    padding: 8px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    margin-left: 10px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .field-grid {
        grid-template-columns: 1fr;
    }

    .form-settings {
        grid-template-columns: 1fr;
    }
}

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .signature-pad {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        tr:nth-child(even) {
            background: var(--bg-light);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            animation: slideIn 0.3s ease;
        }

        .toast-success {
            background: var(--secondary);
        }

        .toast-error {
            background: var(--error);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .hidden {
            display: none;
        }
        .share-buttons {
    margin-top: 20px;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 8px;
}

.share-links {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.share-btn {
    padding: 10px 20px;
    border-radius: 5px;
    text-decoration: none;
    color: white;
    font-weight: 500;
    cursor: pointer;
    border: none;
}

.whatsapp {
    background: #25D366;
}

.telegram {
    background: #0088cc;
}

.copy {
    background: #666;
}

.share-btn:hover {
    opacity: 0.9;
    transform: translateY(-2px);
}
 .student-portal {
    padding: 20px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.storage-section {
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
}

.storage-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin: 15px 0;
}

.stats-dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.stat-card {
    background: linear-gradient(135deg, #6366f1, #4f46e5);
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
}

.feature-actions {
    display: flex;
    gap: 10px;
    margin: 20px 0;
}

.hidden {
    display: none;
}
 :root {
    --primary: #2c3e50 ;
    --secondary: #0ea5e9;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --dark: #1f2937;
    --light: #f9fafb;
    --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
}

.student-portal {
    min-height: 100vh;
    background: var(--light);
    padding: 2rem;
    animation: fadeIn 0.5s ease-out;
}

/* Portal Sections */
.portal-section {
    background: white;
    border-radius: 1.5rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    padding: 2rem;
    margin-bottom: 2rem;
    transform-origin: top;
    animation: slideDown 0.5s ease-out;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.portal-section:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
}

/* Form Search */
.form-search {
    display: flex;
    gap: 1rem;
    margin: 1.5rem 0;
}

.form-input {
    flex: 1;
    padding: 1rem 1.5rem;
    border: 2px solid #e2e8f0;
    border-radius: 1rem;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: var(--light);
}

.form-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
    transform: scale(1.02);
}

.btn {
    padding: 1rem 2rem;
    border: none;
    border-radius: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--gradient);
    color: white;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: 0.5s;
}

.btn:hover::before {
    left: 100%;
}

/* Storage Options */
.storage-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.upload-group {
    background: var(--light);
    padding: 1.5rem;
    border-radius: 1rem;
    transition: all 0.3s ease;
}

.upload-group:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.btn-upload, .btn-capture, .btn-note {
    width: 100%;
    padding: 1rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border-radius: 0.75rem;
    transition: all 0.3s ease;
}

.btn-upload { background: var(--primary); }
.btn-capture { background: var(--success); }
.btn-note { background: var(--secondary); }

/* Storage Stats */
.storage-stats {
    display: flex;
    justify-content: space-around;
    padding: 2rem;
    background: var(--gradient);
    border-radius: 1rem;
    color: white;
    margin: 2rem 0;
}

.stat-item {
    text-align: center;
    animation: pulse 2s infinite;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    display: block;
    margin-top: 0.5rem;
}

/* Items Grid */
.items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    padding: 1.5rem;
}

.view-options {
    display: flex;
    gap: 0.5rem;
}

.btn-view {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-view.active {
    background: var(--primary);
    color: white;
    transform: scale(1.05);
}

/* Activity List */
.activity-list {
    max-height: 400px;
    overflow-y: auto;
    padding: 1rem;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) var(--light);
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .student-portal {
        padding: 1rem;
    }

    .storage-options {
        grid-template-columns: 1fr;
    }

    .storage-stats {
        flex-direction: column;
        gap: 1rem;
    }
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--light);
}

::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 4px;
}

/* Loading States */
.loading {
    position: relative;
}

.loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}
.logout-btn {
    background: linear-gradient(135deg, #ff4b4b, #ff7676);
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 75, 75, 0.2);
}

.logout-btn.loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 200%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    animation: loading 1s infinite;
}

.logging-out {
    animation: fadeOut 0.8s ease forwards;
}

@keyframes loading {
    to {
        transform: translateX(100%);
    }
}

@keyframes fadeOut {
    to {
        opacity: 0;
    }
}
  .fade-out {
    animation: fadeOut 0.5s ease forwards;
}

.fade-in {
    animation: fadeIn 0.5s ease forwards;
}

.slide-out {
    animation: slideOut 0.3s ease forwards;
}

.logout-success {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
    padding: 1rem 2rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

@keyframes fadeOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-10px); }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(50px); opacity: 0; }
}

@keyframes slideIn {
    from { transform: translateX(100px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
  .export-modal, .delete-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;
}

.export-options, .delete-confirmation {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    animation: slideUp 0.3s ease;
}

.btn-export, .btn-delete, .btn-cancel {
    width: 100%;
    padding: 1rem;
    margin: 0.5rem 0;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.btn-export {
    background: #4f46e5;
    color: white;
}

.btn-delete {
    background: #ef4444;
    color: white;
}

.btn-cancel {
    background: #e5e7eb;
    color: #374151;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
 .note-input {
    width: 100%;
    padding: 16px 20px;
    font-size: 16px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    background-color: #f8fafc;
    color: #1e293b;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.note-input:focus {
    outline: none;
    border-color: #6366f1;
    background-color: #ffffff;
    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    transform: translateY(-2px);
}

.note-input::placeholder {
    color: #94a3b8;
    font-weight: 400;
    transition: opacity 0.3s ease;
}

.note-input:focus::placeholder {
    opacity: 0.5;
}

/* Hover Effects */
.note-input:hover {
    border-color: #cbd5e1;
    background-color: #ffffff;
}

/* Typing Animation */
.note-input:not(:placeholder-shown) {
    border-color: #6366f1;
    background-color: #ffffff;
}

/* Responsive Design */
@media (max-width: 768px) {
    .note-input {
        padding: 14px 16px;
        font-size: 15px;
    }
}
  .delete-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

.delete-container {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    padding: 24px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    animation: slideUp 0.4s ease;
}

.delete-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.warning-icon {
    color: #ef4444;
    font-size: 48px;
    text-align: center;
    margin: 20px 0;
}

.delete-message {
    text-align: center;
    margin-bottom: 24px;
}

.delete-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 24px;
}

.btn-delete {
    background: #ef4444;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.btn-cancel {
    background: #e5e7eb;
    color: #374151;
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
  .logout-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border: 2px solid #104;
    border-radius: 8px;
    color: #edd;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
}

.logout-btn:hover {
    background: #ef4;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
}

.logout-btn i {
    font-size: 1.1em;
}
.form-actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
}

.btn-edit, .btn-delete {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: transform 0.2s;
}

.btn-edit {
    background: #3b82f6;
    color: white;
}

.btn-delete {
    background: #ef4444;
    color: white;
}

.edit-modal, .confirm-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 24px;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 20px;
}

.form-card {
    background: white;
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-bottom: 16px;
}

    </style>

</head>
<body>
    <div class="container">
       <div class="logo">
    <div class="logo-emblem">
        <div class="logo-circle">
            <span class="logo-text">HD</span>
            <div class="orbit">
                <span class="globe"></span>
            </div>
        </div>
    </div>
    <div class="logo-title">
        <h1>History Database</h1>
        <span class="logo-subtitle">International Relations Portal</span>
    </div>
</div>

         </div>

        <div class="master-auth-container">
    <div class="master-tabs">
        <button class="master-tab active" data-target="hodAuth">HOD Login</button>
        <button class="master-tab" data-target="studentAuth">Student Portal</button>
    </div>

    <!-- HOD Section -->
    <div class="auth-section active" id="hodAuth">
        <div class="auth-container">

            <div class="input-group">
                <input type="email" id="authEmail" placeholder="Admin Email">
            </div>
            <div class="input-group">
                <input type="password" id="authPassword" placeholder="Password">
            </div>
            <button class="btn btn-primary" onclick="handleAuth()">Access Dashboard</button>
        </div>
    </div>

    <!-- Student Section -->
    <div class="auth-section" id="studentAuth">
        <div class="student-tabs">
            <button class="tab-btn active" data-tab="login">Login</button>
            <button class="tab-btn" data-tab="register">New Account</button>
        </div>

        <div class="auth-form" id="loginForm">
            <input type="email" placeholder="uniquename@his.student" pattern=".*@his\.student$" required>
            <input type="password" placeholder="Password" required>
            <button onclick="studentLogin()" class="btn btn-student">Login</button>
            <a href="#" onclick="showForgotPassword()" class="forgot-link">Reset Password</a>
        </div>

        <div class="auth-form hidden" id="registerForm">
            <input type="email" placeholder="Create uniquename@his.student" pattern=".*@his\.student$" required>
            <input type="password" placeholder="Create Password" required>
            <select id="securityQuestion">
                <option value="">Choose Security Question</option>
                <option value="pet">What was your first pet's name?</option>
                <option value="school">What primary school did you attend?</option>
                <option value="food">What's your favorite food?</option>
                <option value="color">What's your favorite color?</option>
            </select>
            <input type="text" placeholder="Security Answer" required>
            <button onclick="registerStudent()" class="btn btn-student">Create Account</button>
        </div>
    </div>
</div>

        <div id="dashboardContainer" class="hidden">
            <div class="logout-btn">
               <a href="login.html" class="btn btn-outline logout-btn">
    <i class="fas fa-sign-out-alt"></i>
    Logout
</a>

                </div>

            <!-- Form Creation Section -->
            <div class="form-container">
                <h2>Create New Form</h2>
                <div class="form-actions">
                    <button class="btn btn-outline import-btn">
                        <i class="fas fa-file-import"></i> Import Form Header Image
                        <input type="file" class="file-input" accept=".png,.jpg,.jpeg">
                    </button>
                </div>
            <div class="form-container">
                <h2>Create New Form</h2>
                <div class="input-group">
                    <label>PIN</label>
                    <input type="text" id="formPin" placeholder="Enter @His2024">
                </div>
                <div class="input-group">
                    <label>Course Name</label>
                    <input type="text" id="courseName">
                </div>
                <div class="input-group">
    <label>Form Type</label>
    <select id="formType">
        <option value="regular">Regular Form</option>
        <option value="attendance">Attendance Sheet</option>
        <option value="poll">Quick Poll</option>
        <option value="feedback">Student Feedback</option>
        <option value="event">Event Registration</option>
        <option value="assessment">Course Assessment</option>
        <option value="complaint">Complaint Form</option>
        <option value="request">Special Request</option>
        <option value="survey">Department Survey</option>
        <option value="announcement">Class Announcement</option>
    </select>
</div>

<div class="input-group">
    <label>Required Fields</label>
    <div id="fieldSelector" class="field-grid">
        <!-- Basic Info -->
        <label class="field-item"><input type="checkbox" value="name"> Full Name</label>
        <label class="field-item"><input type="checkbox" value="matric"> Matric Number</label>
        <label class="field-item"><input type="checkbox" value="phone"> Phone Number</label>
        <label class="field-item"><input type="checkbox" value="email"> Email</label>
        <label class="field-item"><input type="checkbox" value="dob"> Date of Birth</label>

        <!-- Academic Info -->
        <label class="field-item"><input type="checkbox" value="level"> Level</label>
        <label class="field-item"><input type="checkbox" value="department"> Department</label>
        <label class="field-item"><input type="checkbox" value="cgpa"> CGPA</label>

        <!-- Additional Fields -->
        <label class="field-item"><input type="checkbox" value="photo"> Upload Photo</label>
        <label class="field-item"><input type="checkbox" value="signature"> Digital Signature</label>
        <label class="field-item"><input type="checkbox" value="document"> File Upload</label>
        <label class="field-item"><input type="checkbox" value="location"> Location</label>
    </div>
</div>

<div class="form-settings">
    <div class="setting-item">
        <label><input type="checkbox" id="autoSave"> Enable Autosave</label>
    </div>
    <div class="setting-item">
        <label><input type="checkbox" id="requireSignature"> Require Signature</label>
    </div>
    <div class="setting-item">
        <label><input type="checkbox" id="enableDeadline"> Set Deadline</label>
        <input type="datetime-local" id="deadlineDate" class="deadline-picker">
    </div>
    <div class="setting-item">
        <label><input type="checkbox" id="limitResponses"> Limit Responses</label>
        <input type="number" id="responseLimit" min="1" placeholder="Max responses">
    </div>
</div>

                <button class="btn btn-primary" onclick="createForm()">Generate Form Link</button>
            </div>

            <div id="formsContainer"></div>
        </div>
    </div>

<div class="student-portal hidden" id="studentPortal">
    <!-- Form Access Section -->
         <a href="login.html" class="logout-btn" role="button">
    <i class="fas fa-sign-out-alt"></i>
    Logout
</a>


    <div class="portal-section search-container">

        <h2>Access Forms</h2>
        <div class="form-search">
            <input type="text" id="formCodeInput" placeholder="Enter Form Code" class="form-input">
            <button onclick="searchForm()" class="btn btn-primary">Access Form</button>
        </div>
        <div id="formStatusIndicator" class="status-indicator"></div>
    </div>

    <!-- Active Forms Section -->
    <div class="portal-section active-forms">
        <h2>My Active Forms</h2>
        <div id="activeForms" class="forms-grid"></div>
    </div>


</div>


 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>


   <script>
 const CONFIG = {
    AUTH: {
        VALID_EMAILS: ['toluwanioloyede27@gmail.com', 'bashorunidris18@gmail.com'],
        VALID_PIN: 'h1sense0',
        DEFAULT_PASSWORD: 'h1sense0'
    },
    STORAGE_KEYS: {
        DATABASE: 'hisDatabase',
        STUDENTS: 'students',
        DOCUMENTS: 'studentDocs',
        FORMS: 'hisForms',
        SUBMISSIONS: 'hisSubmissions',
        BACKUP: 'hisBackup'
    },
    STORAGE_VERSION: '1.0'
};

class HisDatabase {
    constructor() {
        this.authorizedEmails = CONFIG.AUTH.VALID_EMAILS;
        this.validPin = CONFIG.AUTH.VALID_PIN;
        this.password = CONFIG.AUTH.DEFAULT_PASSWORD;
        this.currentUser = null;
        this.forms = [];
        this.initializeStorage();
        this.loadFromStorage();
    }

    initializeStorage() {
        if (!localStorage.getItem(CONFIG.STORAGE_KEYS.DATABASE)) {
            const initialData = {
                version: CONFIG.STORAGE_VERSION,
                forms: [],
                currentUser: null,
                lastUpdate: new Date().toISOString()
            };
            this.saveToStorage(initialData);
        }
    }

    loadFromStorage() {
        try {
            const storedData = localStorage.getItem(CONFIG.STORAGE_KEYS.DATABASE);
            if (storedData) {
                const data = JSON.parse(storedData);
                this.forms = data.forms || [];
                this.currentUser = data.currentUser;
                this.createBackup(data);
            }
        } catch (error) {
            console.error('Storage load error:', error);
            this.restoreFromBackup();
        }
    }

    saveToStorage(data = null) {
        const storageData = data || {
            version: CONFIG.STORAGE_VERSION,
            forms: this.forms,
            currentUser: this.currentUser,
            lastUpdate: new Date().toISOString()
        };

        try {
            localStorage.setItem(CONFIG.STORAGE_KEYS.DATABASE, JSON.stringify(storageData));
            this.createBackup(storageData);
        } catch (error) {
            if (error.name === 'QuotaExceededError') {
                this.handleStorageLimit();
            }
        }
    }

    createBackup(data) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.BACKUP, JSON.stringify({
            timestamp: new Date().toISOString(),
            data: data
        }));
    }

    restoreFromBackup() {
        const backup = localStorage.getItem(CONFIG.STORAGE_KEYS.BACKUP);
        if (backup) {
            const { data } = JSON.parse(backup);
            this.forms = data.forms;
            this.currentUser = data.currentUser;
            this.saveToStorage();
        }
    }

    handleStorageLimit() {
        // Remove old submissions
        this.forms = this.forms.map(form => ({
            ...form,
            submissions: form.submissions.slice(-10000) // Keep last 100 submissions
        }));
        this.saveToStorage();
    }

    authenticate(email, password) {
        if (this.authorizedEmails.includes(email) && password === this.password) {
            this.currentUser = email;
            this.saveToStorage();
            return true;
        }
        return false;
    }

    createForm(pin, courseName, type, fields, autoSave) {
        if (pin !== this.validPin) {
            throw new Error('Invalid PIN');
        }

        const form = {
            id: Date.now().toString(36),
            uniqueCode: this.generateUniqueCode(),
            courseName,
            type,
            fields,
            autoSave,
            creator: this.currentUser,
            active: true,
            submissions: [],
            created: new Date().toISOString(),
            lastModified: new Date().toISOString()
        };

        this.forms.push(form);
        this.saveToStorage();
        return form;
    }

    submitForm(formId, submission) {
        const form = this.forms.find(f => f.id === formId);
        if (form && form.active) {
            const enhancedSubmission = {
                ...submission,
                id: Date.now().toString(36),
                timestamp: new Date().toISOString(),
                formCode: form.uniqueCode
            };

            form.submissions.push(enhancedSubmission);
            form.lastModified = new Date().toISOString();
            this.saveToStorage();
            return enhancedSubmission;
        }
        return false;
    }

    generateUniqueCode() {
        const timestamp = Date.now().toString(36);
        const random = Math.random().toString(36).substring(2, 8);
        return `HIS-${timestamp}-${random}`.toUpperCase();
    }

    getForm(formId) {
        return this.forms.find(f => f.id === formId);
    }

    getForms() {
        return this.forms.filter(f => f.creator === this.currentUser);
    }

    getSubmissions(formId) {
        const form = this.getForm(formId);
        return form ? form.submissions : [];
    }

    clearStorage() {
        this.forms = [];
        this.currentUser = null;
        this.saveToStorage();
    }
}

// Student Authentication Class
class StudentAuth {
    constructor() {
        this.students = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.STUDENTS)) || {};
    }

    registerStudent(email, password, securityQ, securityA) {
        if (!email.endsWith('@his.student')) {
            throw new Error('Email must end with @his.student');
        }

        if (this.students[email]) {
            throw new Error('Email already registered');
        }

        this.students[email] = {
            password: this.hashPassword(password),
            securityQuestion: securityQ,
            securityAnswer: this.hashAnswer(securityA),
            createdAt: new Date().toISOString(),
            lastLogin: null
        };

        this.saveToStorage();
        return true;
    }

    validateLogin(email, password) {
        const student = this.students[email];
        if (student && student.password === this.hashPassword(password)) {
            student.lastLogin = new Date().toISOString();
            this.saveToStorage();
            return true;
        }
        return false;
    }

    hashPassword(password) {
        return btoa(password);
    }

    hashAnswer(answer) {
        return btoa(answer.toLowerCase());
    }

    saveToStorage() {
        localStorage.setItem(CONFIG.STORAGE_KEYS.STUDENTS, JSON.stringify(this.students));
    }
}

 class FormSharing {
    static generateShareableMessage(form) {
        const date = new Date().toLocaleDateString();
        return `
ðŸŽ“ NEW FORM ALERT!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸ“š Course: ${form.courseName}
ðŸ‘¨â€ðŸ« HOD: Tolu
ðŸ“… Created: ${date}
ðŸ”‘ Form Code: ${form.uniqueCode}
âœ¨ Fill your requirements here:
ðŸŒ app.his.edu/forms
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Use code to access form!`;
    }

    static copyToClipboard(text) {
        navigator.clipboard.writeText(text)
            .then(() => {
                this.showToast('Copied to clipboard!');
            })
            .catch(() => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                this.showToast('Copied to clipboard!');
            });
    }

    static showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'share-toast';
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.classList.add('fade-out');
            setTimeout(() => toast.remove(), 300);
        }, 2000);
    }

    static shareViaWhatsApp(form) {
        const message = encodeURIComponent(this.generateShareableMessage(form));
        window.open(`https://wa.me/?text=${message}`);
    }

    static shareViaTelegram(form) {
        const message = encodeURIComponent(this.generateShareableMessage(form));
        window.open(`https://t.me/share/url?url=app.his.edu/forms&text=${message}`);
    }

    static copyFormCode(form) {
        this.copyToClipboard(form.uniqueCode);
    }

    static copyFullMessage(form) {
        this.copyToClipboard(this.generateShareableMessage(form));
    }
}


class StudentPortal {
    constructor() {
        this.storage = new StudentStorage();
    }

    async uploadDocument(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const document = {
                    id: Date.now(),
                    name: file.name,
                    type: file.type,
                    data: e.target.result,
                    uploadDate: new Date().toISOString()
                };
                this.storage.saveDocument(document);
                resolve(document);
            };
            reader.readAsDataURL(file);
        });
    }

    async capturePhoto() {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.createElement('video');
        const canvas = document.createElement('canvas');

        video.srcObject = stream;
        await video.play();

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        const photo = {
            id: Date.now(),
            type: 'photo',
            data: canvas.toDataURL('image/jpeg'),
            captureDate: new Date().toISOString()
        };

        this.storage.saveDocument(photo);
        stream.getTracks().forEach(track => track.stop());
        return photo;
    }

    saveNote(text) {
        const note = {
            id: Date.now(),
            type: 'note',
            content: text,
            createDate: new Date().toISOString()
        };
        this.storage.saveDocument(note);
        return note;
    }
}


class HODFeatures {
    constructor() {
        this.polls = [];
        this.announcements = [];
        this.stats = {
            totalForms: 0,
            activeSubmissions: 0,
            studentEngagement: 0
        };
    }

    createPoll(question, options) {
        const poll = {
            id: Date.now(),
            question,
            options,
            responses: [],
            created: new Date().toISOString(),
            active: true
        };
        this.polls.push(poll);
        return poll;
    }

    createAnnouncement(content, type, media) {
        const announcement = {
            id: Date.now(),
            content,
            type,
            media,
            created: new Date().toISOString(),
            views: 0
        };
        this.announcements.push(announcement);
        return announcement;
    }

    updateStats() {
        this.stats = {
            totalForms: db.forms.length,
            activeSubmissions: db.forms.reduce((acc, form) =>
                acc + form.submissions.length, 0),
            studentEngagement: this.calculateEngagement()
        };
        return this.stats;
    }

    calculateEngagement() {
        return this.polls.reduce((acc, poll) =>
            acc + poll.responses.length, 0) +
            this.announcements.reduce((acc, ann) =>
                acc + ann.views, 0);
    }
}


class StudentStorage {
    constructor() {
        this.documents = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEYS.DOCUMENTS)) || {};
    }

    saveDocument(doc) {
        if (!this.documents[doc.type]) {
            this.documents[doc.type] = [];
        }
        this.documents[doc.type].push(doc);
        this.persistStorage();
    }

    getDocuments(type) {
        return this.documents[type] || [];
    }

    persistStorage() {
        localStorage.setItem(CONFIG.STORAGE_KEYS.DOCUMENTS, JSON.stringify(this.documents));
    }
}


const Helpers = {
    generateUniqueCode() {
        const timestamp = Date.now().toString(36);
        const random = Math.random().toString(36).substring(2, 8);
        return `HIS-${timestamp}-${random}`.toUpperCase();
    },

    showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }
};


function handleAuth() {
    const email = document.getElementById('authEmail').value;
    const password = document.getElementById('authPassword').value;

    if (db.authenticate(email, password)) {
        document.querySelector('.master-auth-container').classList.add('hidden');
        document.getElementById('dashboardContainer').classList.remove('hidden');
        Helpers.showToast('Login successful');
        refreshFormsList();
    } else {
        Helpers.showToast('Invalid credentials', 'error');
    }
}
  function createForm() {
    const formData = {
        pin: document.getElementById('formPin').value,
        courseName: document.getElementById('courseName').value,
        type: document.getElementById('formType').value,
        fields: Array.from(document.querySelectorAll('#fieldSelector input:checked'))
            .map(input => input.value),
        autoSave: document.getElementById('autoSave').checked
    };

    try {
        const form = db.createForm(
            formData.pin,
            formData.courseName,
            formData.type,
            formData.fields,
            formData.autoSave
        );

        const message = FormSharing.generateShareableMessage(form);
        displayShareOptions(form, message);
        Helpers.showToast('Form created successfully');
        refreshFormsList();
    } catch (error) {
        Helpers.showToast(error.message, 'error');
    }
}

function displayShareOptions(form, message) {
    const shareContainer = document.createElement('div');
    shareContainer.className = 'share-buttons';
    shareContainer.innerHTML = `
        <h4>Form Created Successfully!</h4>
        <div class="code-display">Form Code: ${form.uniqueCode}</div>
        <div class="share-links">
            <button id="copyMessageBtn" class="share-btn copy">
                <i class="fas fa-copy"></i> Copy Message
            </button>
            <button id="copyCodeBtn" class="share-btn copy">
                <i class="fas fa-key"></i> Copy Code
            </button>
            <button id="whatsappShareBtn" class="share-btn whatsapp">
                <i class="fab fa-whatsapp"></i> Share WhatsApp
            </button>
            <button id="telegramShareBtn" class="share-btn telegram">
                <i class="fab fa-telegram"></i> Share Telegram
            </button>
        </div>
    `;

    document.querySelector('.form-container').appendChild(shareContainer);
    setupShareButtons(form, message);
}

function setupShareButtons(form, message) {
    document.getElementById('copyMessageBtn').addEventListener('click', () => {
        copyToClipboard(message);
    });

    document.getElementById('copyCodeBtn').addEventListener('click', () => {
        copyToClipboard(form.uniqueCode);
    });

    document.getElementById('whatsappShareBtn').addEventListener('click', () => {
        window.open(`https://wa.me/?text=${encodeURIComponent(message)}`);
    });

    document.getElementById('telegramShareBtn').addEventListener('click', () => {
        window.open(`https://t.me/share/url?url=app.his.edu/forms&text=${encodeURIComponent(message)}`);
    });
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text)
        .then(() => Helpers.showToast('Copied to clipboard!'))
        .catch(() => {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            Helpers.showToast('Copied to clipboard!');
        });
}

 function addFormActions(form) {
    const actionsHtml = `
        <div class="form-actions">
            <button onclick="editForm(${form.id})" class="btn-edit">
                <i class="fas fa-edit"></i> Edit
            </button>
            <button onclick="confirmDelete(${form.id})" class="btn-delete">
                <i class="fas fa-trash"></i> Delete
            </button>
        </div>
    `;
    return actionsHtml;
}

function editForm(formId) {
    const form = db.forms.find(f => f.id === formId);
    if (!form) return;

    const editModal = document.createElement('div');
    editModal.className = 'edit-modal';
    editModal.innerHTML = `
        <div class="modal-content">
            <h3>Edit Form</h3>
            <form id="editFormForm">
                <input type="text" id="editPin" value="${form.pin}" placeholder="PIN">
                <input type="text" id="editCourseName" value="${form.courseName}" placeholder="Course Name">
                <select id="editType">
                    <option value="assignment" ${form.type === 'assignment' ? 'selected' : ''}>Assignment</option>
                    <option value="test" ${form.type === 'test' ? 'selected' : ''}>Test</option>
                </select>
                <div class="field-selector">
                    ${form.fields.map(field => `
                        <label>
                            <input type="checkbox" value="${field}" checked>
                            ${field}
                        </label>
                    `).join('')}
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-save">Save Changes</button>
                    <button type="button" onclick="closeModal()" class="btn-cancel">Cancel</button>
                </div>
            </form>
        </div>
    `;

    document.body.appendChild(editModal);

    document.getElementById('editFormForm').addEventListener('submit', (e) => {
        e.preventDefault();
        updateForm(formId);
    });
}

function updateForm(formId) {
    const updatedData = {
        pin: document.getElementById('editPin').value,
        courseName: document.getElementById('editCourseName').value,
        type: document.getElementById('editType').value,
        fields: Array.from(document.querySelectorAll('.field-selector input:checked'))
            .map(input => input.value)
    };

    const formIndex = db.forms.findIndex(f => f.id === formId);
    if (formIndex !== -1) {
        db.forms[formIndex] = { ...db.forms[formIndex], ...updatedData };
        db.saveToStorage();
        refreshFormsList();
        closeModal();
        Helpers.showToast('Form updated successfully');
    }
}

function confirmDelete(formId) {
    const confirmModal = document.createElement('div');
    confirmModal.className = 'confirm-modal';
    confirmModal.innerHTML = `
        <div class="modal-content">
            <h3>Delete Form</h3>
            <p>Are you sure you want to delete this form? This action cannot be undone.</p>
            <div class="modal-actions">
                <button onclick="deleteForm(${formId})" class="btn-delete">Delete</button>
                <button onclick="closeModal()" class="btn-cancel">Cancel</button>
            </div>
        </div>
    `;
    document.body.appendChild(confirmModal);
}

function deleteForm(formId) {
    db.forms = db.forms.filter(f => f.id !== formId);
    db.saveToStorage();
    refreshFormsList();
    closeModal();
    Helpers.showToast('Form deleted successfully');
}

function closeModal() {
    const modal = document.querySelector('.edit-modal, .confirm-modal');
    if (modal) {
        modal.remove();
    }
}

function refreshFormsList() {
    const formsList = document.querySelector('.forms-list');
    if (!formsList) return;

    formsList.innerHTML = db.forms.map(form => `
        <div class="form-card">
            <div class="form-info">
                <h3>${form.courseName}</h3>
                <p>Type: ${form.type}</p>
                <p>Code: ${form.uniqueCode}</p>
            </div>
            ${addFormActions(form)}
        </div>
    `).join('');
}

function refreshFormsList() {
    const container = document.getElementById('formsContainer');
    container.innerHTML = db.forms
        .filter(form => form.creator === db.currentUser)
        .map(form => `
            <div class="form-container">
                <h3>${form.courseName}</h3>
                <p>Code: ${form.uniqueCode}</p>
                <p>Type: ${form.type}</p>
                <p>Submissions: ${form.submissions.length}</p>
                <p>Status: ${form.active ? 'Active' : 'Locked'}</p>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="toggleForm('${form.id}')">
                        ${form.active ? 'Lock' : 'Unlock'}
                    </button>
                    <button class="btn btn-primary" onclick="exportData('${form.id}')">
                        Export Data
                    </button>
                </div>
            </div>
        `).join('');
}

// Initialize Application
document.addEventListener('DOMContentLoaded', () => {
    // Initialize instances
    window.db = new HisDatabase();
    window.studentAuth = new StudentAuth();
    window.studentPortal = new StudentPortal();
    window.hodFeatures = new HODFeatures();

    // Setup event listeners
    setupEventListeners();
});

function setupEventListeners() {
    // Tab Navigation
    document.querySelectorAll('.master-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.master-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-section').forEach(s => s.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.target).classList.add('active');
        });
    });

    // Student Tab Navigation
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const tab = btn.dataset.tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.add('hidden'));
            btn.classList.add('active');
            document.getElementById(`${tab}Form`).classList.remove('hidden');
        });
    });
}



function toggleForm(formId) {
    const form = db.forms.find(f => f.id === formId);
    if (form) {
        form.active = !form.active;
        db.saveToStorage();
        refreshFormsList();
        showToast(`Form ${form.active ? 'unlocked' : 'locked'}`);
    }
}
 function initiateExport(formId) {
    const dateSelectionModal = createDateSelectionModal();
    document.body.appendChild(dateSelectionModal);

    dateSelectionModal.querySelector('form').addEventListener('submit', (e) => {
        e.preventDefault();
        const selectedDate = getSelectedDate();
        exportData(formId, selectedDate);
        dateSelectionModal.remove();
    });
}

function exportData(formId, submissionDate) {
    const form = db.forms.find(f => f.id === formId);
    if (!form || !form.submissions) {
        showToast('No data available for export', 'warning');
        return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Document Header
    addDocumentHeader(doc, form);

    // Table Configuration
   const tableConfig = {
    headers: ['S/N', 'Name', 'Matric Number', 'Submission Date', 'Signature'],
    data: form.submissions.map((sub, index) => [
        index + 1,
        sub.studentName || 'N/A',
        sub.matricNumber || 'N/A',
        submissionDate,
        '' // Signature line placeholder
    ]),
    columnStyles: {
        4: { cellWidth: 40 } // Width for signature column
    }
};

    // Generate Table
    generateTable(doc, tableConfig);

    // Add Summary and Save
    finalizePDF(doc, form);
}

function addDocumentHeader(doc, form) {
    doc.setFontSize(16);
    doc.text(`${form.courseName || 'Course'} - Submissions Report`, 15, 15);

    doc.setFontSize(12);
    doc.text(`Department: ${form.department || 'N/A'}`, 15, 25);
    doc.text(`Generated: ${new Date().toLocaleDateString()}`, 15, 35);
}

function generateTable(doc, config) {
    doc.autoTable({
        head: [config.headers],
        body: config.data,
        startY: 45,
        margin: { top: 15 },
        styles: {
            fontSize: 10,
            cellPadding: 5,
            lineWidth: 0.5,
            lineColor: [0, 0, 0],
            textColor: [0, 0, 0]
        },
        headStyles: {
            fillColor: [255, 255, 255],
            textColor: [0, 0, 0],
            fontStyle: 'bold',
            lineWidth: 1
        },
        bodyStyles: {
            fillColor: [255, 255, 255]
        },
        alternateRowStyles: {
            fillColor: [255, 255, 255]
        },
        didDrawPage: (data) => {
            doc.setFontSize(10);
            const pageNumber = `Page ${data.pageNumber} of ${doc.getNumberOfPages()}`;
            doc.text(pageNumber, data.settings.margin.left, doc.internal.pageSize.height - 10);
        }
    });
}

function finalizePDF(doc, form) {
    const finalY = doc.lastAutoTable.finalY || 50;
    doc.text(`Total Submissions: ${form.submissions.length}`, 15, finalY + 10);

    const timestamp = new Date().toISOString().split('T')[0];
    const fileName = `${form.courseName}_submissions_${timestamp}.pdf`;

    try {
        doc.save(fileName);
        showExportSuccess(fileName);
    } catch (error) {
        showToast('Export failed. Please try again.', 'error');
    }
}

function createDateSelectionModal() {
    const modal = document.createElement('div');
    modal.className = 'date-selection-modal';
    modal.innerHTML = `
        <div class="modal-content">
            <h3>Select Submission Date</h3>
            <form>
                <div class="date-options">
                    <label>
                        <input type="radio" name="dateType" value="current" checked>
                        Use Today's Date (${new Date().toLocaleDateString()})
                    </label>
                    <label>
                        <input type="radio" name="dateType" value="custom">
                        Custom Date
                        <input type="date" id="customDate" disabled>
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-export">Generate PDF</button>
                    <button type="button" class="btn-cancel" onclick="this.closest('.date-selection-modal').remove()">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    `;
    return modal;
}

function getSelectedDate() {
    const dateType = document.querySelector('input[name="dateType"]:checked').value;
    if (dateType === 'current') {
        return new Date().toLocaleDateString();
    }
    return new Date(document.getElementById('customDate').value).toLocaleDateString();
}

function deleteSubmission(formId, submissionId) {
    const confirmDelete = document.createElement('div');
    confirmDelete.className = 'delete-modal';
    confirmDelete.innerHTML = `
        <div class="delete-confirmation">
            <h3>Confirm Deletion</h3>
            <p>Are you sure you want to delete this submission?</p>
            <div class="delete-actions">
                <button onclick="confirmDeletion('${formId}', '${submissionId}')" class="btn-delete">
                    Delete
                </button>
                <button onclick="cancelDeletion()" class="btn-cancel">
                    Cancel
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(confirmDelete);
}

function confirmDeletion(formId, submissionId) {
    const form = db.forms.find(f => f.id === formId);
    if (form) {
        form.submissions = form.submissions.filter(sub => sub.id !== submissionId);
        db.updateForm(form);
        showToast('Submission deleted successfully', 'success');
        refreshSubmissionsTable(formId);
    }
    document.querySelector('.delete-modal').remove();
}

function studentLogin() {
    const email = document.querySelector('#loginForm input[type="email"]').value;
    const password = document.querySelector('#loginForm input[type="password"]').value;

    if (studentAuth.validateLogin(email, password)) {
        showStudentPortal();
        showToast('Welcome to student portal');
    } else {
        showToast('Invalid credentials', 'error');
    }
}

function registerStudent() {
    const email = document.querySelector('#registerForm input[type="email"]').value;
    const password = document.querySelector('#registerForm input[type="password"]').value;
    const securityQ = document.getElementById('securityQuestion').value;
    const securityA = document.querySelector('#registerForm input[type="text"]').value;

    try {
        studentAuth.registerStudent(email, password, securityQ, securityA);
        showToast('Registration successful');
        switchToLoginTab();
    } catch (error) {
        showToast(error.message, 'error');
    }
}

function showStudentPortal() {
    document.querySelector('.master-auth-container').classList.add('hidden');
    document.getElementById('studentPortal').classList.remove('hidden');
}

function searchForm() {
    const formCode = document.getElementById('formCodeInput').value;
    const form = db.forms.find(f => f.uniqueCode === formCode && f.active);

    if (form) {
        displayFormForStudent(form);
    } else {
        showToast('Form not found or inactive', 'error');
    }
}

function displayFormForStudent(form) {
    const formContainer = document.createElement('div');
    formContainer.className = 'student-form-container';
    formContainer.innerHTML = `
        <h3>${form.courseName}</h3>
        <form id="studentSubmissionForm">
            ${generateFormFields(form.fields)}
            <button type="submit" class="btn btn-primary">Submit Form</button>
        </form>
    `;

    document.getElementById('studentPortal').appendChild(formContainer);
    setupFormSubmission(form.id);
}

function generateFormFields(fields) {
    return fields.map(field => `
        <div class="input-group">
            <label>${field.charAt(0).toUpperCase() + field.slice(1)}</label>
            <input type="text" name="${field}" required>
        </div>
    `).join('');
}

function setupFormSubmission(formId) {
    document.getElementById('studentSubmissionForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const submission = Object.fromEntries(formData.entries());

        db.submitForm(formId, submission);
        showToast('Form submitted successfully');
        e.target.reset();
    });
}

function loadStudentDashboard() {
    // Show student portal and hide login form
    document.getElementById('studentPortal').classList.remove('hidden');
    document.getElementById('loginForm').classList.add('hidden');

    // Load student's documents
    const storedItems = document.getElementById('storedItems');
    storedItems.innerHTML = ''; // Clear existing items

    // Add logout button to the dashboard
    const logoutButton = document.createElement('button');
    logoutButton.innerText = 'Logout';
    logoutButton.className = 'logout-btn';
    logoutButton.onclick = logout;
    document.querySelector('.student-storage').prepend(logoutButton);

    // Display student documents if they exist
    if (studentAuth.currentStudent && studentAuth.currentStudent.documents) {
        studentAuth.currentStudent.documents.forEach(doc => {
            const item = document.createElement('div');
            item.className = 'stored-item';
            item.innerHTML = `
                <span>${doc.name}</span>
                <span>${new Date(doc.uploadDate).toLocaleDateString()}</span>
                <button onclick="removeDocument('${doc.id}')">Delete</button>
            `;
            storedItems.appendChild(item);
        });
    }
}
 function recoverPassword() {
    const email = document.querySelector('#recoveryForm input[type="email"]').value;
    const answer = document.querySelector('#recoveryForm input[type="text"]').value;

    if (studentAuth.verifySecurityAnswer(email, answer)) {
        const newPassword = generateTemporaryPassword();
        studentAuth.resetPassword(email, newPassword);
        showToast(`Your temporary password is: ${newPassword}`);
        showLoginForm();
    } else {
        showToast('Invalid security answer', 'error');
    }
}
function logout() {
    // Start logout animation
    const studentPortal = document.getElementById('studentPortal');
    studentPortal.classList.add('fade-out');

    // Clear authentication state
    studentAuth.currentStudent = null;
    localStorage.removeItem('studentAuth');
    sessionStorage.clear();

    // Reset all form states
    const formInputs = document.querySelectorAll('input');
    formInputs.forEach(input => {
        input.value = '';
        input.classList.remove('active', 'valid', 'invalid');
    });

    // Clear stored data
    clearStoredData();

    // Animate transition
    setTimeout(() => {
        // Hide student portal
        studentPortal.classList.add('hidden');
        studentPortal.classList.remove('fade-out');

        // Show login form with animation
        const loginForm = document.getElementById('loginForm');
        loginForm.classList.remove('hidden');
        loginForm.classList.add('fade-in');

        // Handle logout button
        const logoutBtn = document.querySelector('.logout-btn');
        if (logoutBtn) {
            logoutBtn.classList.add('slide-out');
            setTimeout(() => logoutBtn.remove(), 300);
        }

        // Reset view state
        resetViewState();

        // Show logout success message
        showLogoutSuccess();
    }, 500);
}

function clearStoredData() {
    // Clear form-related data
    document.getElementById('formCodeInput').value = '';
    document.getElementById('noteInput').value = '';

    // Clear stored documents and submissions
    localStorage.removeItem('storedDocuments');
    localStorage.removeItem('submissions');
    localStorage.removeItem('formData');
}

function resetViewState() {
    // Reset any active tabs or panels
    document.querySelectorAll('.active').forEach(element => {
        element.classList.remove('active');
    });

    // Clear any displayed data
    document.getElementById('storedItems').innerHTML = '';
    document.getElementById('activeForms').innerHTML = '';
    document.getElementById('submissionRecords').innerHTML = '';
}
function showLogoutSuccess() {
    const successMessage = document.createElement('div');
    successMessage.className = 'logout-success';
    successMessage.innerHTML = `
        <i class="fas fa-check-circle"></i>
        <span>Logged out successfully</span>
    `;
    document.body.appendChild(successMessage);

    // Redirect to login page after showing message
    setTimeout(() => {
        successMessage.remove();
        window.location.href = '#login'; // Add your login page URL here
    }, 2000);

    // Alternative approach using window.location.replace
    // setTimeout(() => {
    //     successMessage.remove();
    //     window.location.replace('login.html');
    // }, 2000);
}


function handleFormSubmission(formId) {
    const form = document.getElementById('studentSubmissionForm');
    const submissionTracker = {
        submissionCount: 0,
        editsRemaining: 3,
        lastSubmission: null
    };

    // Load existing submission data
    const loadExistingSubmission = () => {
        const existingData = localStorage.getItem(`form_${formId}_${studentAuth.currentStudent?.id}`);
        if (existingData) {
            const parsed = JSON.parse(existingData);
            submissionTracker.submissionCount = parsed.submissionCount;
            submissionTracker.editsRemaining = parsed.editsRemaining;
            submissionTracker.lastSubmission = parsed.lastSubmission;

            updateSubmissionStatus();
        }
    };

    const updateSubmissionStatus = () => {
        const statusDiv = document.getElementById('submissionStatus');
        if (!statusDiv) return;

        statusDiv.innerHTML = `
            <div class="submission-info">
                <span>Submissions: ${submissionTracker.submissionCount}</span>
                <span>Edits Remaining: ${submissionTracker.editsRemaining}</span>
                ${submissionTracker.lastSubmission ?
                    `<span>Last Submitted: ${new Date(submissionTracker.lastSubmission).toLocaleString()}</span>`
                    : ''}
            </div>
        `;
    };

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Check submission limits
        if (submissionTracker.submissionCount > 0 && submissionTracker.editsRemaining === 0) {
            Helpers.showToast('Maximum submission limit reached', 'error');
            return;
        }

        const formData = new FormData(form);
        const submission = {
            id: Date.now(),
            timestamp: new Date().toISOString(),
            studentId: studentAuth.currentStudent?.id,
            data: {},
            submissionNumber: submissionTracker.submissionCount + 1
        };

        // Convert FormData to structured object
        for (let [key, value] of formData.entries()) {
            submission.data[key] = value;
        }

        // Handle file uploads
        const fileInputs = form.querySelectorAll('input[type="file"]');
        if (fileInputs.length) {
            submission.files = [];
            for (let fileInput of fileInputs) {
                if (fileInput.files.length) {
                    const file = fileInput.files[0];
                    const base64 = await convertFileToBase64(file);
                    submission.files.push({
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: base64
                    });
                }
            }
        }

        try {
            // Save submission
            db.submitForm(formId, submission);

            // Update submission tracker
            submissionTracker.submissionCount++;
            if (submissionTracker.submissionCount > 1) {
                submissionTracker.editsRemaining--;
            }
            submissionTracker.lastSubmission = submission.timestamp;

            // Save tracker state
            localStorage.setItem(
                `form_${formId}_${studentAuth.currentStudent?.id}`,
                JSON.stringify(submissionTracker)
            );

            // Update UI
            updateSubmissionStatus();
            updateSubmissionCount(formId);
            generateSubmissionReceipt(submission);

            // Show success message
            Helpers.showToast(
                `Form ${submissionTracker.submissionCount > 1 ? 'edited' : 'submitted'} successfully! ` +
                `${submissionTracker.editsRemaining} edits remaining`,
                'success'
            );

            // Clear form if it's the first submission
            if (submissionTracker.submissionCount === 1) {
                form.reset();
            }

        } catch (error) {
            Helpers.showToast('Submission failed. Please try again.', 'error');
        }
    });

    // Initialize submission tracker
    loadExistingSubmission();
}


   </script>
</body>
</html>

